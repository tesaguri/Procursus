From 1782566bc7db8d04537956aa1c8f5734d4cc1b8c Mon Sep 17 00:00:00 2001
From: Daiki Mizukami <tesaguriguma@gmail.com>
Date: Tue, 10 Oct 2023 07:23:14 +0900
Subject: [PATCH] login: Make `login -f` work on volumes with the nosuid option
 set

---
 login.tproj/login.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/login.tproj/login.c b/login.tproj/login.c
index f86675b..8b71317 100644
--- a/login.tproj/login.c
+++ b/login.tproj/login.c
@@ -902,7 +902,7 @@ main(int argc, char *argv[])
 	 * We don't need to be root anymore, so set the login name and
 	 * the UID.
 	 */
-	if (setlogin(username) != 0) {
+	if (uid == (uid_t)0 && setlogin(username) != 0) {
 		syslog(LOG_ERR, "setlogin(%s): %m - exiting", username);
 		bail(NO_SLEEP_EXIT, 1);
 	}
-- 
2.37.3

